<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>좌표 읽기</title>
    <script>
        window.onload = function () {
            alert('본 기기가 위치 정보를 지원하지 않습니다.');
            return;
        }

        /*
        getCurrentPosition : 사용자의 현재 기기의 위치를 position
        [옵션]
        frequency : 위치 정보를 가져올 시간 간격으로 단위는 밀리세컨드(ms), 기본값은 10000
        enableHighAccuracy : 위치 정보의 정확성을 최상으로 할지를 지정
        timeout : 기기로부터 위치 정보를 가져올 때까지의 최대 대기 시간 단위는 밀리세컨드(ms)
        maximumAge : 위치 정보를 캐싱하는 기간을 지정, 단위는 밀리세컨드(ms)
        */
        navigator.geolocation.getCurrentPosition(success, fail, { timeout: 10000 });

        //위도 경도값 호출이 가능한 경우
        function success(position) {//현재 위치 값
            /*
            latitude : 위도
            longtitude : 경도
            altitude : 고도
            accuracy : 위도와 경도의 정확도
            altitudeAccuracy : 고도의 정확도
            */
            document.getElementById('startLat').innerHTML = position.coords.latitude;
            document.getElementById('startLon').innerHTML = position.coords.longitude;
        }

        //위도 경도 값이 호출 불가능한 경우
        function fail(error) {
            alert('에러 코드 발생 : ' + error.code);
            /*
            0 : 알 수 없는 오류
            1 : 권한 거부
            2 : 위치 추적 실패
            3 : 시간 초과 
            */
        };

        //현재 위치를 계속 확인
        // watchPostition : 일정 간격으로 기기의 위치가 바뀌면 현재 기기의 위치를 position 오브젝트형으로 반환
        let watchId = navigator.geolocation.watchPosition(
        function(position) {
            let lat = position.coords.latitude;
            let lon = position.coords.longitude;
            let acc = position.coords.accuracy;
            document.getElementById('currentLat').innerHTML = lat;
            document.getElementById('currentLon').innerHTML = lon;
            document.getElementById('acc').innerHTML = acc;
        });

        const btn = document.getElementById('btn');
        //이벤트 연결
        btn.addEventListener('click', function() {
            //clearWatch : watchPosition 메서드로 위치 추적을 하는 것을 해제하는 역할
            navigator.geolocation.clearWatch(watchId);
            alert('위치 추적이 해제됨');
        }, false);
    
    </script>
</head>

<body>
    시작위치(위도, 경도) : <br>
    <span id="startLat">위도</span>&deg;
    <span id="startLon">경도</span>&deg;
    <br><br>
    현재 위치 (위도, 경도) : <br>
    <span id="currentLat">위도</span>&deg;
    <span id="currentLon">경도</span>&deg;
    <br><br>
    정확도 : <br>
    <span id="acc">정확도</span>미터 정도의 정확도를 보임
    <br><br>
    <button id="btn">위치 추적 해제</button>
</body>

</html>